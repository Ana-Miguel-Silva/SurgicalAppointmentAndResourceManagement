


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor US's</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>


<body>
  <h1 class="h1 title glow" (click)="ngOnInit()" style="padding: 1cm; color:white"> Doctor </h1>
  <button id="mapButton" class="hospMapBtn" (click)="openModal('mapModal')">
      Hospital Map
      <span class="icon">üìç</span>
    </button>
    <div class="container">

        <div class="row g-3">

      <div class="container col-md-4">
        <div class="container-lg  selectionDiv" (click)="openModal('createRequestModal')">
          <div class="form-floating mb-3">
            <h3 class="title">Resgister Operation Request</h3>
          </div>
        </div>
      </div>

      <div class="container col-md-4">
        <div class="container-lg  selectionDiv" (click)="openModal('listOperationRequestModal')">
          <div class="form-floating mb-3">
            <h3 class="title">List Operation Requests</h3>
          </div>
        </div>
      </div>

      <div class="container col-md-4">
        <div class="container-lg  selectionDiv" (click)="openModal('listAllergies')">
          <div class="form-floating mb-3">
            <h3 class="title">List Allergies</h3>
          </div>
        </div>
      </div>

      <div class="container col-md-4">
        <div class="container-lg  selectionDiv" (click)="openModal('registerMedicalRecordModal')">
          <div class="form-floating mb-3">
            <h3 class="title">Register Medical Record</h3>
          </div>
        </div>
      </div>

      <div class="container col-md-4">
        <div class="container-lg  selectionDiv" (click)="openModal('listMedicalRecordModal')">
          <div class="form-floating mb-3">
            <h3 class="title">List Medical Record</h3>
          </div>
        </div>
      </div>

      <div class="container col-md-4">
        <div class="container-lg  selectionDiv" (click)="openModal('createAppointmentModal')">
          <div class="form-floating mb-3">
            <h3 class="title">Create Appointment</h3>
          </div>
        </div>
      </div>

      <div class="container col-md-4">
        <div class="container-lg  selectionDiv" (click)="openModal('listAppointmentModal')">
          <div class="form-floating mb-3">
            <h3 class="title">Update Appointments</h3>
          </div>
        </div>
      </div>

    </div>
  </div>


  <div [ngStyle]="{'display': isModalOpen('listOperationRequestModal') ? 'block' : 'none'}"
    id="listOperationRequestModal" class="modal">
    <div class="modal-content">
      <span (click)="closeModal('listOperationRequestModal')" class="close">&times;</span>
      <div>
        <div class="table-wrapper">
          <!-- Action Buttons Section -->
          <div class="table-title" > 
            <h2 style="font-weight: 600;">Operation Requests</h2>
            <div class="action-buttons">
              <button (click)="openModal('filterRequestModal')" id="filterRequest">
                <i class="bi bi-filter"></i> Filter Requests
              </button>
            </div>
          </div>

          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Doctor Email</th>
                <th>Patient Email</th>
                <th>Operation Type</th>
                <th>Deadline</th>
                <th>Priority</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of filteredRequests">
                <td>{{ request.emailDoctor }}</td>
                <td>{{ request.emailPatient }}</td>
                <td>{{ request.operationTypeName }}</td>
                <td>{{ request.deadline | date:'mediumDate' }}</td>
                <td>{{ request.priority }}</td>
                <td>
                  <button class="btn btn-warning" (click)="setUpdateRequest(request)">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-danger" (click)="openModal('deleteModal'); updateRequest.id = request.id;">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>



  <!-- Create Operation Request Modal -oncreate-->
  <div [ngStyle]="{'display': isModalOpen('createRequestModal') ? 'block' : 'none'}" id="createRequestModal"
    class="modal">
    <div class="modal-content">
      <span (click)="closeModal('createRequestModal')" class="close">&times;</span>
      <form (ngSubmit)="onCreateRequest(operationRequest)" class="row g-3 needs-validation" novalidate>
        <h3 class="text-center" style="font-weight: 600;" >Create Operation Request</h3>

        <!-- Patient Email -->
        <div class="col-md-6">
          <label for="patientEmail" class="form-label" style="font-weight: 600;">Patient Email</label>
          <input type="email" class="form-control" id="patientEmail" [(ngModel)]="operationRequest.patientEmail"
            name="patientEmail" required style="border-radius: 8px;"/>
          <div class="valid-feedback">Looks good!</div>
        </div>

        <!-- Operation Type Name -->
        <div class="col-md-6">
          <label for="operationTypeName" class="form-label" style="font-weight: 600;">Operation Type Name</label>
          <input type="text" class="form-control" id="operationTypeName"
            [(ngModel)]="operationRequest.operationTypeName" name="operationTypeName" required style="border-radius: 8px;"/>
          <div class="valid-feedback">Looks good!</div>
        </div>

        <!-- Deadline -->
        <div class="col-md-6">
          <label for="deadline" class="form-label" style="font-weight: 600;">Deadline</label>
          <input type="date" class="form-control" id="deadline" [(ngModel)]="operationRequest.deadline" name="deadline"
            required style="border-radius: 8px;"/>
          <div class="valid-feedback">Looks good!</div>
        </div>

        <!-- Priority -->
        <div class="col-md-6">
          <label for="priority" class="form-label" style="font-weight: 600;">Priority</label>
          <select class="form-select" id="priority" [(ngModel)]="operationRequest.priority" name="priority" required style="border-radius: 8px;">
            <option value="Urgent">Urgent</option>
            <option value="Elective">Elective</option>
            <option value="Emergency">Emergency</option>
          </select>
          <div class="valid-feedback">Looks good!</div>
        </div>

      <!-- Policy Agreement Section -->
      <div class="col-12" style="margin-bottom: 20px;">
          <button type="button" class="btn btn-secondary" id="registerRequest" (click)="openPolicyModal()">Read and Agree to Policy</button>
      </div>
      <!-- Submit Button -->
       <div class="col-12 text-center">
       <button class="btn btn-primary" type="submit" id="submitRegisterRequest" [disabled]="!isPolicyAccepted" style="border-radius: 8px;">Create Request</button>
        </div>
      </form>
    </div>
  </div>








  <div class="modal" [ngStyle]="{'display': isModalOpen('createAppointmentModal') ? 'block' : 'none'}">
    <div class="modal-content">
      <span (click)="closeModal('createAppointmentModal')" class="close">&times;</span>
      <form (ngSubmit)="onCreateAppointment()">
        
        <!-- Surgery Room Dropdown -->
        <div class="form-group">
          <label for="surgeryRoom" style="font-weight: 600;">Surgery Room</label>
          <select id="surgeryRoom" class="form-control" [(ngModel)]="selectedSurgeryRoomId" name="surgeryRoom" required style="border-radius: 8px;">
            <option value="" disabled>Select a Surgery Room</option>
            <option *ngFor="let surgeryRoom of surgeryRooms" [value]="surgeryRoom.id">
              Room Number: {{ surgeryRoom.roomNumber }} - Room Type: ({{ surgeryRoom.type }})
            </option>
          </select>
        </div>
  
        <!-- Operation Request Dropdown -->
        <div class="form-group">
          <label for="operationRequest" style="font-weight: 600;">Operation Request</label>
          <select id="operationRequest" class="form-control" [(ngModel)]="selectedOperationRequestId" name="operationRequest" required style="border-radius: 8px;">
            <option value="" disabled>Select an Operation Request</option>
            <option *ngFor="let operationRequest of notscheduledOperationRequests" [value]="operationRequest.id">
              Type: {{ operationRequest.operationTypeName }} - Patient Email: {{ operationRequest.emailPatient }} 
              - Priority: {{ operationRequest.priority }} - Deadline: {{ operationRequest.deadline | date:'yyyy-MM-dd' }}
            </option>
          </select>
        </div>
  
        <!-- Date Input -->
        <div class="form-group">
          <label for="startDate" style="font-weight: 600;">Start Date and Time</label>
          <input id="startDate" type="datetime-local" class="form-control" [(ngModel)]="appointmentData.date.start" name="startDate" required style="border-radius: 8px;"/>
        </div>
  
        <!-- Staff Selection -->
        <div class="staff-list">
          <label for="staffSelect" style="font-weight: 600;">Select Staff for Appointment</label>
          <select id="staffSelect" class="form-control" [(ngModel)]="selectedStaffMemberId" name="staffSelect" style="border-radius: 8px;">
            <option value="" disabled>Select a Staff Member</option>
            <option *ngFor="let staff of staffs" [value]="staff.id">
              License: {{ staff.licenseNumber }} - Role: {{ staff.role }} - Specialization: {{ staff.specialization }}
            </option>
          </select>
        </div>
        <button type="button" class="btn btn-primary mt-3" (click)="addStaffMember()">
          <span style="border-radius: 8px;">+</span> Add Staff
        </button>
        


          <!-- Staff List -->
          <div class="staff-list" style="margin-top: 20px;">
            <ul id="staffEntries">
              <li
                *ngFor="let staff of appointmentData.selectedStaff; let i = index"
                class="staff-item"
                style="padding: 8px;"
              >
                {{ staff.licenseNumber }} {{ staff.role }} ({{ staff.specialization }})
                <span
                  class="remove-button"
                  (click)="removeStaffMember(i)"
                >
                  X
                </span>
              </li>
            </ul>
          </div>
  
        
      <!-- Policy Agreement Section -->
      <div class="col-12" style="margin-bottom: 20px;">
        <button type="button" class="btn btn-secondary" id="registerAppointment" (click)="openPolicyModal()">Read and Agree to Policy</button>
    </div>
    <!-- Submit Button -->
     <div class="col-12 text-center">
     <button class="btn btn-primary" type="submit" id="submitRegisterAppointment" [disabled]="!isPolicyAccepted" style="border-radius: 8px;">Create Appointment</button>
      </div>
      
      </form>
    </div>
  </div>

  


<!-- List Appointment Modal -->
<div [ngStyle]="{'display': isModalOpen('listAppointmentModal') ? 'block' : 'none'}"
  id="listAppointmentModal" class="modal">
  <div class="modal-content">
    <span (click)="closeModal('listAppointmentModal')" class="close">&times;</span>
    <div>
      <div class="table-wrapper">
        <!-- Table Title -->
        <div class="table-title">
          <h2>Appointments</h2>
        </div>

        <!-- Appointment Table -->
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Room Number</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let appointment of appointments">
              <td>{{ appointment.roomNumber }}</td>
              <td>{{ appointment.date.startTime | date:'medium' }}</td>
              <td>{{ appointment.date.endTime | date:'medium' }}</td>
              <td>
                <button class="btn btn-warning" (click)="setUpdateAppointment(appointment)">
                  <i class="bi bi-pencil"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- Update Appointment Modal -->
<div [ngStyle]="{'display': isModalOpen('updateAppointmentModal') ? 'block' : 'none'}"
     id="updateAppointmentModal" class="modal">
  <div class="modal-content">
    <span (click)="closeModal('updateAppointmentModal')" class="close">&times;</span>
    <form (ngSubmit)="onUpdateAppointment(updateAppointment)">

      <!-- Surgery Rooms Dropdown -->
      <div class="form-group">
        <label for="updateRoom" style="font-weight: 600;">Room</label>
        <select id="updateRoom" class="form-control" [(ngModel)]="updateAppointment.roomId" name="updateRoom" required style="border-radius: 8px;">
          <option value="" disabled>Select a Room</option>
          <option *ngFor="let room of surgeryRooms" [value]="room.id">
              Room Number: {{ room.roomNumber }} - Room Type: ({{ room.type }})
          </option>
        </select>
      </div>

      <!-- Start Date -->
      <div class="form-group">
        <label for="updateStartDate" style="font-weight: 600;">Start Date</label>
        <input
          id="updateStartDate"
          type="datetime-local"
          class="form-control"
          [(ngModel)]="updateAppointment.start"
          name="updateStartDate"
          required style="border-radius: 8px;"/>
      </div>

      <!-- Staff Selection -->
      <div class="staff-list">
        <label for="updateStaffSelect" style="font-weight: 600;">Select Staff</label>
        <div class="form-group">
          <select id="updateStaffSelect" class="form-control" [(ngModel)]="selectedUpdateStaffMemberId" name="updateStaffSelect" style="border-radius: 8px;">
            <option value="" disabled>Select a Staff Member</option>
            <option *ngFor="let staff of staffs" [value]="staff.id">
              Licence Number: {{ staff.licenseNumber }} - Role: {{ staff.role }} - Specialization: {{ staff.specialization }}
            </option>
          </select>

          <button type="button" class="btn btn-primary mt-3" (click)="addUpdateStaffMember()">
            <span style="border-radius: 8px;">+</span> Add Staff
          </button>
        </div>
      </div>

<!-- Updated Staff List -->
<div class="staff-list" style="margin-top: 20px;">
  <ul id="staffEntries">
    <li *ngFor="let staffId of updateAppointment.selectedStaff; let i = index" class="staff-item" style="padding: 8px;">
      <!-- Find the staff object based on staffId -->
      <ng-container *ngIf="staffId">
        <!-- Get the staff object with the corresponding staffId -->
        <ng-container *ngIf="getStaffById(staffId)">
          <span>{{ getStaffById(staffId)?.licenseNumber }} - {{ getStaffById(staffId)?.role }} ({{ getStaffById(staffId)?.specialization }})</span>
          <span class="remove-button" (click)="removeUpdateStaffMember(i)">X</span>
        </ng-container>
      </ng-container>
    </li>
  </ul>
</div>

      <!-- Policy Agreement Section -->
      <div class="col-12" style="margin-bottom: 20px;">
        <button type="button" class="btn btn-secondary" id="updateAppointment" (click)="openPolicyModal()">Read and Agree to Policy</button>
    </div>
    <!-- Submit Button -->
     <div class="col-12 text-center">
     <button class="btn btn-primary" id="submitUpdateAppointment" type="submit" [disabled]="!isPolicyAccepted" style="border-radius: 8px;">Update Appointment</button>
      </div>
    </form>
  </div>
</div>


  <!-- Filter Operation Requests Modal -->
  <div [ngStyle]="{'display': isModalOpen('filterRequestModal') ? 'block' : 'none'}" id="filterRequestModal"
    class="modal">
    <div class="modal-content">
      <span (click)="closeModal('filterRequestModal')" class="close">&times;</span>
      <form (ngSubmit)="onFilterRequests()">
        <h3 class="text-center" style="font-weight: 600;">Filter Operation Requests</h3>

        <div class="mb-3">
          <label for="filterDoctorEmail" class="form-label" style="font-weight: 600;">Doctor Email:</label>
          <input type="text" id="filterDoctorEmail" [(ngModel)]="filter.emailDoctor" name="filterDoctorEmail"
            class="form-control" style="border-radius: 8px;"/>
        </div>

        <div class="mb-3">
          <label for="filterpatientId" class="form-label" style="font-weight: 600;">Patient Email:</label>
          <input type="text" id="filterpatientId" [(ngModel)]="filter.emailPatient" name="filterpatientId"
            class="form-control" style="border-radius: 8px;"/>
        </div>

        <div class="mb-3">
          <label for="filterOperationType" class="form-label" style="font-weight: 600;">Operation Type:</label>
          <input type="text" id="filterOperationType" [(ngModel)]="filter.operationTypeName" name="filterOperationType"
            class="form-control" style="border-radius: 8px;"/>
        </div>

        <div class="mb-3">
          <label for="filterPriority" class="form-label" style="font-weight: 600;">Priority:</label>
          <select id="filterPriority" [(ngModel)]="filter.priority" name="filterPriority" class="form-select" style="border-radius: 8px;">
            <option value="">All</option>
            <option value="Urgent">Urgent</option>
            <option value="Elective">Elective</option>
            <option value="Emergency">Emergency</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary" id="applyFilter" style="border-radius: 8px;">Apply Filter</button>
      </form>
    </div>
  </div>

  <!-- Update Operation Request Modal -->
  <div [ngStyle]="{'display': isModalOpen('updateRequestModal') ? 'block' : 'none'}" id="updateRequestModal"
    class="modal">
    <div class="modal-content">
      <span (click)="closeModal('updateRequestModal')" class="close">&times;</span>
      <form (ngSubmit)="onUpdateRequest(updateRequest)">
        <h3 class="text-center" style="font-weight: 600;"> Update Operation Request</h3>

        <!-- Deadline -->
        <div class="mb-3">
          <label for="updateDeadline" class="form-label" style="font-weight: 600;">Deadline:</label>
          <input type="date" id="updateDeadline" [(ngModel)]="updateRequest.deadline" name="updateDeadline"
            class="form-control" required style="border-radius: 8px;"/>
        </div>

        <!-- Priority -->
        <div class="mb-3">
          <label for="updatePriority" class="form-label" style="font-weight: 600;">Priority:</label>
          <select id="updatePriority" [(ngModel)]="updateRequest.priority" name="updatePriority" class="form-select"
            required style="border-radius: 8px;">
            <option value="Urgent">Urgent</option>
            <option value="Elective">Elective</option>
            <option value="Emergency">Emergency</option>
          </select>
        </div>

             <!-- Policy Agreement Section -->
      <div class="col-12" style="margin-bottom: 20px;">
        <button type="button" class="btn btn-secondary" id="updateRequest" (click)="openPolicyModal()">Read and Agree to Policy</button>
    </div>
    <!-- Submit Button -->
     <div class="col-12 text-center">
     <button class="btn btn-primary" type="submit" id="submitUpdateRequest" [disabled]="!isPolicyAccepted" style="border-radius: 8px;">Update Request</button>
      </div>

      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div [ngStyle]="{'display': isModalOpen('deleteModal') ? 'block' : 'none'}" id="deleteModal" class="modal">
    <div class="modal-content">
      <span (click)="closeModal('deleteModal')" class="close">&times;</span>
      <div>
        <h3 class="text-center" style="font-weight: 600;">Confirm Delete</h3>
        <p class="text-center" style="font-size: 25px; font-weight: 300;" >Are you sure you want to delete this operation request?</p>
        <button class="btn btn-danger" id="deleteRequest" (click)="onDeleteRequest(updateRequest.id)" style="margin-right: 5px; border-radius: 8px;" >Yes,
          Delete</button>
        <button class="btn btn-secondary" (click)="closeModal('deleteModal')" style="border-radius: 8px;">Cancel</button>
      </div>
    </div>
  </div>


  <div [ngStyle]="{'display': isModalOpen('mapModal') ? 'block' : 'none'}" id="mapModal" class="modal" style=" padding-top: 20px;">
      <div id="mapModalContent" class="modal-content" style="height: 95vh;">
          <span (click)="closeModal('mapModal')" class="close">&times;</span>
          <input type="datetime-local" class="form-control" id="mapTime" placeholder="" (change)="onMapTimeChange($event)">
          <br><br>

          <div id="floating-info-div" *ngIf="roomData">
            <div id="floating-table-container">
              <table class="info" id="info-table">
                <tr>
                  <th colspan="2" class="table-header">Room Information</th>
                </tr>
                <tr>
                  <td>Room Number:</td>
                  <td>{{roomData.roomNumber}}</td>
                </tr>
                <tr>
                  <td>Capacity:</td>
                  <td>{{roomData.capacity}}</td>
                </tr>
                <tr>
                  <td>Status:</td>
                  <td>{{roomData.status}}</td>
                </tr>
                <tr>
                  <td>Assigned Equipment:</td>
                  <td>
                    <ul>
                      <li *ngFor="let equipment of roomData?.assignedEquipment">{{equipment}}</li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <td>Maintenance Slots:</td>
                  <td>
                    <ul>
                      <li *ngFor="let slot of roomData?.maintenanceSlots">
                        Start: {{slot?.startTime}} <br />
                        End: {{slot?.endTime}}
                      </li>
                    </ul>
                  </td>
                </tr>
              </table>
            </div>
          </div>


          <div #canvasContainer class="canvas-container" id="canvasContainer">
            <div id="parent" hidden>
              <div id="views-panel" hidden>
                <table class="views" hidden>
                  <tr>
                    <td>
                      <label>View:</label>
                      <select id="view">
                        <option value="fixed">Fixed</option>
                        <option value="first">First-person</option>
                        <option value="third">Third-person</option>
                        <option value="top">Top</option>
                      </select>
                    </td>
                    <td>
                      <label>Orientation (h):</label>
                      <input type="number" id="horizontal" required>
                    </td>
                    <td>
                      <label>Orientation (v):</label>
                      <input type="number" id="vertical" required>
                    </td>
                    <td>
                      <input type="button" id="reset" value="Reset view">
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label>Projection:</label>
                      <select id="projection">
                        <option value="perspective">Perspective</option>
                        <option value="orthographic">Orthographic</option>
                      </select>
                    </td>
                    <td>
                      <label>Distance:</label>
                      <input type="number" id="distance" required>
                    </td>
                    <td>
                      <label>Zoom:</label>
                      <input type="number" id="zoom" required>
                    </td>
                    <td>
                      <input type="button" id="reset-all" value="Reset all views">
                    </td>
                  </tr>
                </table>
              </div>

              <div id="help-panel" hidden>
                <table class="help" id="help-table">
                  <tr>
                    <th colspan="2" style="font-size: 3.0vmin">Help</th>
                  </tr>
                  <tr>
                    <th colspan="2" style="text-align: left">Select active view</th>
                  </tr>
                  <tr>
                    <td></td>
                    <td>Fixed view</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>First-person view</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>Third-person view</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>Top view</td>
                  </tr>
                  <tr>
                    <th colspan="2" style="text-align: left">Toggle view mode</th>
                  </tr>
                  <tr>
                    <td></td>
                    <td>Single-view mode / multiple-views mode</td>
                  </tr>
                </table>
              </div>

              <div id="subwindows-panel" hidden>
                <table class="subwindows">
                  <tr>
                    <td>
                      <label>Multiple views:</label>
                      <input type="checkbox" id="multiple-views">
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label>User interface:</label>
                      <input type="checkbox" id="user-interface">
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label>Mini-map:</label>
                      <input type="checkbox" id="mini-map">
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label>Help:</label>
                      <input type="checkbox" id="help">
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label>Statistics:</label>
                      <input type="checkbox" id="statistics">
                    </td>
                  </tr>
                </table>
              </div>
          </div>
        </div>
      </div>
    </div>

  <div [ngStyle]="{'display': isModalOpen('listAllergies') ? 'block' : 'none'}" id="listAllergies" class="modal">
    <div id="mapModalContent" class="modal-content" style="height: 75vh;">
      <span (click)="closeModal('listAllergies')" class="close">&times;</span>
      <div>

        <form class="row g-3 needs-validation" novalidate="">
          <div class="col-md-10"></div>

          <div class="col-md-2">
            <div class="input-group">
              <span class="input-group-text" id="basic-addon1"><i class="bi bi-funnel-fill"></i></span><button
                class="btn btn-outline-info" (click)="openModal('filterRequestModal')"> Filter </button>
            </div>
          </div>

          <div class="col-md-12">
            <div class="table-wrapper">
              <div class="table-title">
                <form class="row g-3 needs-validation" novalidate="">
                  <table class="table table-striped table-hover table-over">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!--TODO: Est√° US's √© para estar no local do admin, est√° no doctor temporariamente -->
                      <tr *ngFor="let request of allergiesList; let i = index" (click)="selectAllergie(request.id)"
                        [ngClass]="{ 'selected-row': selectedAllergie === request.id }">
                        <td>{{ i + 1 }}</td>
                        <td><input class="selectRequest" type="radio" id="allergie_{{ request.id }}" name="id"
                            value="{{ request.id }}" [checked]="selectedAllergie === request.id" hidden>{{
                          request.designacao }} </td>

                        <td>{{ request.descricao }}</td>
                        <!--<td>{{ request.descricao }}</td>-->
                        <!--<td id="active_{{ request.email.fullEmail }}_{{request.active}}">
                            <span *ngIf="request.active; else failure" class="badge rounded-pill bg-success">Yes</span>
                            <ng-template #failure>
                              <span class="badge rounded-pill bg-danger">No</span>
                            </ng-template>
                          </td>-->
                      </tr>
                    </tbody>
                  </table>
                </form>
              </div>
            </div>
          </div>

          <div class="col-md-9"></div>
          <div class="col-md-3">
            <button class="fs-5 btn btn-outline-info">View <i class="bi bi-info-square-fill"></i></button>
            <button class="fs-5 btn btn-outline-warning"> Edit <i class="bi bi-pencil-square"></i></button>
            <button class="fs-5 btn btn-outline-danger"> Deactivate <i class="bi bi-archive-fill"></i></button>
          </div>
        </form>


        <div class="dropdown">
          <input type="text" placeholder="Escolha uma op√ß√£o" [(ngModel)]="filterText" (input)="filterOptions()"
            (focus)="showDropdown = true" (blur)="hideDropdown()" />
          <ul *ngIf="showDropdown" class="dropdown-list">
            <li *ngFor="let option of filteredOptions" (mousedown)="selectOption(option.designacao)">
              {{ option.designacao }}
            </li>
          </ul>
        </div>

      </div>

    </div>
  </div>









  <!-- Create Operation Request Modal -->
  <div [ngStyle]="{'display': isModalOpen('registerMedicalRecordModal') ? 'block' : 'none'}"
    id="registerMedicalRecordModal" class="modal">
    <div class="modal-content">
      <span (click)="closeModal('registerMedicalRecordModal')" class="close">&times;</span>
      <form class="row g-3 needs-validation" novalidate>
        <h3 class="text-center">Register New Medical Record</h3>

        <div class="col-md-6 offset-md-1">
          <label for="patientEmail" class="form-label">Patient Email</label>
          <input type="email" class="form-control" id="patientEmailMedicalRecord" [(ngModel)]="medicalRecordRequest.patientId"
            name="patientEmail" required />
          <div class="valid-feedback">Looks good!</div>
        </div>

        <div class="col-mb-4"></div>

        <div class="col-md-12 offset-md-1">
          <ul id="tags">
            <li *ngFor="let tag of tagsAllergies; let i = index" class="tag">
              {{ tag.designacao }} - {{ tag.descricao }} - {{ tag.status }}
              <button type="button" class="delete-button" (click)="removeAllergie(i); $event.preventDefault()">
                X
              </button>
            </li>
          </ul>
        </div>


        <div class="col-md-10 offset-md-1">
          <div class="input-group has-validation">
            <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
            <input id="tag-filter" class="form-control" type="text" name="filterAllergieName"
              [(ngModel)]="filterAllergieNameText"  [ngModelOptions]="{standalone: true}"  placeholder="Choose an allergie"
              (input)="filterAllergieNameOptions()" (focus)="showDropdown = true" (blur)="onBlur('filterAllergie')" />
              <span class="input-group-text" id="validAllergie">{{ validAllergieText }}</span>
            <input type="text" class="form-control" id="descricaoAllergie"  style="width: 40%;" [(ngModel)]="filterAllergieDescricaoText"  [ngModelOptions]="{standalone: true}" 
              name="descricaoAllergie" required readonly />
          </div>
          <ul *ngIf="showDropdown" class="dropdown-list">
            <li *ngFor="let option of filteredAllergieNameOptions"
              (mousedown)="selectOptionTagAllergies(option.designacao)">
               {{ option.designacao }}  {{option.descricao}}
            </li>
          </ul>
        </div>

        <div class="col-md-12"></div>        


        <div class="col-md-2 offset-md-1">
          <div class="input-group has-validation">
            <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
            <input id="tag-filter" class="form-control" type="text"  name="filterAllergieStatus" [(ngModel)]="filterAllergieStatusText"
              [ngModelOptions]="{standalone: true}" (input)="filterAllergieStatusOptions()"
              (focus)="showDropdown3 = true" (blur)="onBlur('filterAllergieStatus')" placeholder="Filter status" />
            </div>
            <ul *ngIf="showDropdown3" class="dropdown-list">
              <li *ngFor="let option of filteredAllergieStatusOptions"
                (mousedown)="selectOptionTagStatusAllergies(option)">
                {{ option }}
              </li>
            </ul>              
        </div>

       

        <div class="col-12 offset-md-1">
          <button type="button" class="btn btn-primary" (click)="addAllergie('no')" [disabled]="!isAllergieValid()">Add Allergie</button>
        </div>

        <div class="col-mb-4"></div>


        <div class="col-md-12 offset-md-1">
          <ul id="tags">
            <li *ngFor="let condition of tagsConditions; let i = index" class="tagsCondition">
              {{ condition.designacao }} - {{ condition.descricao }} - {{ condition.status }}
              <button type="button" class="delete-button"
                (click)="removeMedicalCondition(i); $event.preventDefault()">X</button>
            </li>
          </ul>
        </div>

        <div class="col-md-10 offset-md-1">
          <div class="input-group has-validation">
            <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
            <input id="condition-filter" class="form-control" type="text" name="filterMedicalCondiitonDesignacao"
              [(ngModel)]="filterTextCondition" placeholder="Choose an medical condition"
              (input)="filterOptionsMedicalConditions()" (focus)="showDropdown2 = true"(blur)="onBlur('filterCondition')" />
              <span class="input-group-text" id="validCondition">{{ validConditionText }}</span>
            <input type="text" class="form-control" id="descricaoCondition"  style="width: 40%;" [(ngModel)]="filterConditionDescricaoText"
              name="descricaoCondition" required readonly />
          </div>
          <ul *ngIf="showDropdown2" class="dropdown-list">
            <li *ngFor="let option of filteredOptionsConditions"
              (mousedown)="selectOptionMedicalCondition(option.designacao)">
              [{{option.codigo}}] {{ option.designacao }}
            </li>
          </ul>
        </div>

        <div class="col-md-12"></div>

        <div class="col-md-2 offset-md-1">
          <div class="input-group has-validation">
            <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
            <input id="status-filter" class="form-control" type="text" name="filterConditionStatus"
              [(ngModel)]="filterConditionStatusText" placeholder="Filter status"
              (input)="filterConditionStatusOptions()" (focus)="showDropdown4 = true" (blur)="onBlur('filterStatus')" />         
          
          </div>
          <ul *ngIf="showDropdown4" class="dropdown-list">
            <li *ngFor="let option of filteredAllergieStatusOptions"
              (mousedown)="selectOptionTagStatusCondition(option)">
              {{ option }}
            </li>
          </ul>
        </div>
        



        <div class="col-md-6 offset-md-1">
          <div class="input-group has-validation">
            <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
            <textarea class="form-control" id="medicalConditionSymptoms" [(ngModel)]="sintomasCodition"
              name="medicalConditionSymptoms" required rows="1"
              placeholder="Symptoms [Separated by a comma (,)]"></textarea>
          </div>

        </div>
        <div class="col-12 offset-md-1">
          <button type="button" class="btn btn-primary" (click)="addMedicalCondition('no')" [disabled]="!isConditionValid()">Add Condition</button>
        </div>


        <div class="col-mb-6"></div>


        <div class="col-md-6 offset-md-1">
          <ul id="descriptions">
            <li *ngFor="let description of descricaoList; let i = index" class="description">
              {{ description }}
              <button type="button" class="delete-button" (click)="removeDescription(i); $event.preventDefault()">
                X
              </button>
            </li>
          </ul>
        </div>

        <div class="col-mb-6"></div>


        <div class="col-md-6 offset-md-1">
          <label for="descricao" class="form-label">Medical Record Description</label>
          <input type="text" class="form-control" id="descricao" [(ngModel)]="filterTextDescription"
            name="descricao" required />
          <div class="valid-feedback">Looks good!</div>
        </div>


      <div class="col-12 offset-md-1">
        <button type="button" class="btn btn-primary" id="registerDescriptionMedicalRecord" (click)="addDescription()"  [disabled]="!filterTextDescription || filterTextDescription.trim() === ''" >Add Description</button>
      </div>



       <div class="col-mb-6 offset-md-1"></div>

        <div class="col-md-12 d-flex justify-content-center mt-4" style="margin-bottom: 20px;">
          <button type="button" class="btn btn-secondary  me-2" id="registerMedicalRecordPolicy" (click)="openPolicyModal()">Read and Agree to Policy</button>
        
          <button class="btn btn-primary" type="submit" id="buttonRegisterMedicalRecord" [disabled]="!isPolicyAccepted"  (click)="onCreateMedicalRecord(medicalRecordRequest)" >Create Medical Record</button>
        </div>

      </form>
    </div>
  </div>


  <!-- Modal para a Pol√≠tica -->
  <div [ngStyle]="{'display': showPolicyModal ? 'block' : 'none'}" class="modal" id="policyModal" style="z-index: 9000">
    <div class="modal-content">
      <span (click)="closePolicyModal()" class="close">&times;</span>
      <h3>Policy Agreement</h3>
      <p>
        A sua privacidade √© importante para n√≥s. Este documento explica como recolhemos, utilizamos, partilhamos e protegemos os seus dados pessoais no √¢mbito do nosso projeto hospitalar, como alunos do cursos de Engenharia Inform√°tica do ISEP (Instituto Superior de Engenharia do Porto) em conformidade com o Regulamento Geral  sobre a Prote√ß√£o de Dados (RGPD).
      </p>

      <h4>1. Quem Somos</h4>
      <p>
        Somos uma organiza√ß√£o dedicada √† presta√ß√£o de cuidados de sa√∫de e bem-estar, focada na gest√£o de consultas,
        cirurgias e recursos. Tratamos dados pessoais para garantir a melhor experi√™ncia e seguran√ßa aos nossos
        pacientes.
      </p>
      <p style="margin-bottom: 20px;">
        <strong>Contacte-nos:</strong> <br>
        <span style="display: block; text-indent: 20px;">
          Encarregado de Prote√ß√£o de Dados (DPO) ‚Äì Paulo Alexandre Sousa
        </span> 
        <span style="display: block; text-indent: 20px;">
          Email: {{ 'pauloSousaDpo&#64;gmail.com' }}
        </span>
        <span style="display: block; text-indent: 20px;">
          N√∫mero de telem√≥vel: 966866765
        </span> 
        <span style="display: block; text-indent: 20px;">
          Morada: Rua Mte. Guilherme Camarinha, 221, 2.¬∫ esquerdo
        </span> 
      </p>

      <h4>2. Dados Pessoais que Recolhemos</h4>
      <p style="margin-bottom: 20px;">
        Recolhemos as seguintes informa√ß√µes:
      <ul>
        <li><strong>Identifica√ß√£o:</strong> Nome completo, data de nascimento, g√©nero, morada.</li>
        <li><strong>Contacto:</strong> N√∫mero de telem√≥vel, email.</li>
        <li><strong>Sa√∫de:</strong> Hist√≥rico m√©dico, alergias, contacto de emerg√™ncia, n√∫mero de registo m√©dico.</li>
      </ul>
      Os dados s√£o fornecidos diretamente pelos utilizadores ou, quando aplic√°vel, atrav√©s de terceiros, como hospitais
      parceiros.


      <h4 style="margin-top: 20px;">3. Tipo de Tratamento dos Dados Pessoais</h4>
      <p style="margin-bottom: 20px;">
        Os dados pessoais poder√£o ser usados por outros utilizadores da aplica√ß√£o, no caso somente o pr√≥prio, o seu m√©dico e terceiros com a devida autoriza√ß√£o. <br>
        Desta forma, os dados ser√£o utilizados para:
      <ul>
        <li><strong>Recolha:</strong> Obter dados dos utilizadores para tratamento no sistema.</li>
        <li><strong>Destrui√ß√£o:</strong> Eliminar dados quando deixarem de ser relevantes, por exemplo, a pedido do titular.</li>
        <li><strong>Divulga√ß√£o:</strong> Partilhar dados com terceiros, como m√©dicos respons√°veis.</li>
        <li><strong>Conserva√ß√£o:</strong> Armazenar os dados na base de dados.</li>
        <li><strong>Consulta:</strong> Permitir acesso ao perfil do paciente por utilizadores autorizados (pr√≥prio ou m√©dicos/staff: para confirmar dados, marcar cirurgias e registar o hist√≥rico m√©dico do titular).</li>
        <li><strong>Altera√ß√£o:</strong> Atualizar ou corrigir dados de utilizadores.</li>
        <li><strong>Organiza√ß√£o:</strong> Estruturar os dados para consultas futuras.</li>
        <li><strong>Limita√ß√µes:</strong> Restringir o acesso com base no papel do utilizador (ex.: pacientes acessam apenas os seus pr√≥prios dados).</li>        
      </ul>


      <h4>4. Finalidades do Tratamento dos Dados</h4>
      <p style="margin-bottom: 20px;">
        Os dados pessoais recolhidos s√£o tratados para as seguintes finalidades, de acordo com o Artigo 5.¬∫ 
        do RGPD:
      <ul>
        <li><strong>Agendamento e gest√£o de consultas e cirurgias:</strong> Os dados, como nome, email, n√∫mero de telem√≥vel, alergias e hist√≥rico m√©dico, s√£o utilizados para organizar e gerir consultas e cirurgias com efici√™ncia. Esses dados s√£o essenciais para a presta√ß√£o de servi√ßos cl√≠nicos, garantindo que as necessidades do paciente sejam atendidas adequadamente. </li>
        <li><strong>Personaliza√ß√£o de experi√™ncias:</strong>Envio de mensagens personalizadas por email (e.g., lembretes de consultas ou outras comunica√ß√µes relevantes para o paciente). </li>
        <li><strong>Emerg√™ncias m√©dicas:</strong> Os contactos de emerg√™ncia e informa√ß√µes de sa√∫de, como hist√≥rico m√©dico e alergias, s√£o utilizados para proteger a vida e a integridade f√≠sica do titular em emerg√™ncias m√©dica. </li>
        <li><strong>Cumprimento de obriga√ß√µes legais:</strong> Conserva√ß√£o de nome, morada, hist√≥rico m√©dico, e alergias por 20 anos, ap√≥s o √∫ltimo registro de atividade m√©dica, conforme exigido por lei, uma vez que estes dados s√£o essenciais para assegurar a continuidade dos cuidados de sa√∫de. Para a personaliza√ß√£o da experiencia, os dados ser√£o guardados at√© que o titular solicite a revoga√ß√£o do consentimento ou os dados deixem de ser relevantes para a finalidade. </li>
        <li><strong>Monitoriza√ß√£o do sistema:</strong> An√°lise de dados como nome, email, hist√≥rico de acessos e alergias para garantir a seguran√ßa e efici√™ncia do sistema de informa√ß√£o, evitando acessos n√£o autorizados, perdas de dados ou falhas operacionais. 
        </li>
        <br> Sendo assim, cada finalidade √© justificada conforme os Artigos 6.¬∫ e 9.¬∫ do RGPD.
      </ul>


      <h4>5. Base Legal para o Tratamento</h4>
      <p style="margin-bottom: 20px;">
        O tratamento dos dados pessoais baseia-se nos seguintes fundamentos legais, conforme o Artigo 6.¬∫ e Artigo 9.¬∫ do RGPD:
      <ul>
        <li><strong>Consentimento:</strong> Para comunica√ß√µes personalizadas e partilha de dados com terceiros.</li>
        <li><strong>Execu√ß√£o de Contrato:</strong> Para a presta√ß√£o de servi√ßos de sa√∫de contratados.</li>
        <li><strong>Obrigatoriedade Jur√≠dica:</strong> Para cumprir normas legais aplic√°veis ao setor da sa√∫de e de
          acordo com a Constitui√ß√£o/lei portuguesa.</li>
        <li><strong>Interesse Vital:</strong> Em emerg√™ncias m√©dicas, para proteger a vida ou integridade do titular dos
          dados.</li>
        <li><strong>Interesse Leg√≠timo:</strong> Para garantir a seguran√ßa do sistema e melhorar os nossos servi√ßos.
        </li>
      </ul>


      <h4>6. Com Quem Partilhamos os Seus Dados</h4>
      <p style="margin-bottom: 20px;">
        Partilhamos os seus dados apenas quando estritamente necess√°rio e de forma segura com:
      <ul>
        <li><strong>Profissionais de sa√∫de:</strong> M√©dicos, enfermeiros e outros profissionais cl√≠nicos.</li>
        <li><strong>Autoridades legais:</strong> Quando exigido por lei.</li>
      </ul>
      Todos os terceiros com quem colaboramos est√£o sujeitos a acordos de confidencialidade e ao cumprimento do RGPD.


      <h4 style="margin-top: 20px;">7. Tempo de Conserva√ß√£o dos Dados</h4>
      <p style="margin-bottom: 20px;">
        Conservamos os seus dados pessoais apenas pelo tempo necess√°rio para cumprir as finalidades descritas nesta
        Pol√≠tica:
      <ul>
        <li><strong>Hist√≥rico m√©dico e alergias:</strong> Conservados por 20 anos, conforme obriga√ß√µes legais.</li>
        <li><strong>Dados de contacto:</strong> Mantidos at√© que o titular solicite o apagamento ou deixe de ser
          relevante.</li>
        <li><strong>Outros dados:</strong> Eliminados ap√≥s o per√≠odo definido para cada finalidade.</li>
      </ul>


      <h4 style="margin-top: 20px;">8. Os Seus Direitos</h4>
      <p style="margin-bottom: 20px;">
        Enquanto titular dos dados, tem os seguintes direitos garantidos pelo RGPD:
      <ul>
        <li><strong>Acesso:</strong> Pode solicitar informa√ß√µes sobre os dados pessoais que temos sobre si.</li>
        <li><strong>Retifica√ß√£o:</strong> Pode corrigir dados incorretos ou incompletos.</li>
        <li><strong>Apagamento:</strong> Tem o direito de solicitar o apagamento dos seus dados, exceto quando a lei
          exigir a conserva√ß√£o.</li>
        <li><strong>Portabilidade:</strong> Pode pedir uma c√≥pia dos seus dados em formato eletr√¥nico, na aplica√ß√£o.
        </li>
        <li><strong>Oposi√ß√£o:</strong> Pode opor-se ao tratamento dos seus dados em certas situa√ß√µes.</li>
        Caso o titular se recuse a consentir o tratamento dos dados, haver√° restri√ß√µes nas funcionalidades desta aplica√ß√£o. Se for um paciente, n√£o conseguir√° atualizar o seu perfil. Para o caso de um m√©dico ou staff, n√£o ser√° poss√≠vel registar ou atualizar pacientes, criar ou atualizar alergias, condi√ß√µes m√©dicas, hist√≥rico m√©dico ou marca√ß√£o de cirurgias. 
        <li><strong>Limita√ß√£o:</strong> Pode solicitar a limita√ß√£o do tratamento dos seus dados em condi√ß√µes
          espec√≠ficas.</li>
      </ul>


      <p style="margin-bottom: 20px;">
        Para exercer os seus direitos, contacte-nos atrav√©s do email {{ 'pauloSousaDpo&#64;gmail.com' }} ou do n√∫mero de telem√≥vel: 966866765.
      </p>

      <h4 style="margin-top: 20px;"> 9. Seguran√ßa dos Dados </h4>
      <p style="margin-bottom: 20px;">
        Implementamos medidas de seguran√ßa t√©cnicas e organizacionais para proteger os seus dados pessoais contra acesso n√£o autorizado, altera√ß√£o, destrui√ß√£o ou divulga√ß√£o. Asseguramos tamb√©m a encripta√ß√£o e monitoriza√ß√£o regular do sistema.
      </p>

      <h4 style="margin-top: 20px;"> 10. Viola√ß√µes de Dados </h4>
      <p style="margin-bottom: 20px;">
        Em caso de viola√ß√£o de dados pessoais, notificaremos a Comiss√£o Nacional de <strong> Prote√ß√£o de Dados
          (CNPD)</strong> em at√© 72 horas ap√≥s o incidente e informaremos os titulares dos dados quando for aplic√°vel.
      </p>

      <h4 style="margin-top: 20px;"> 11. Atualiza√ß√µes desta Pol√≠tica </h4>
      <p style="margin-bottom: 20px;">
        Esta Pol√≠tica de Privacidade pode ser atualizada periodicamente para refletir mudan√ßas legais ou operacionais.
        Recomendamos que consulte esta p√°gina regularmente.
      </p>

      <p style="margin-bottom: 20px;">
        <strong> Data da √∫ltima atualiza√ß√£o: 27 de dezembro de 2024 </strong>
      </p>


      <div class="text-center">
        <button class="btn btn-success me-3" id="acceptPolicy" (click)="acceptPolicy()">Accept</button>
        <button class="btn btn-danger" (click)="rejectPolicy()">Decline</button>
      </div>
    </div>
  </div>



  <div [ngStyle]="{'display': isModalOpen('listMedicalRecordModal') ? 'block' : 'none'}" id="listMedicalRecordModal"
    class="modal">
    <div class="modal-content">
      <span (click)="closeModal('listMedicalRecordModal')" class="close">&times;</span>
      <div>

        <form class="row g-3 needs-validation" novalidate="">
          <div class="col-md-10"></div>


          <div class="col-md-12">
            <div class="table-wrapper">
              <div class="table-title">
                <table class="table table-striped table-hover table-over">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Date</th>
                      <th>Staff</th>
                      <th>Patient Email</th>
                      <th>Allergies</th>
                      <th>Medical Conditions</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let request of medicalRecordRequests; let i = index"
                      (click)="selectMedicalRecord(request.patientEmail)"
                      [ngClass]="{ 'selected-row': selectedPatientEmailMedicalRecord === request.patientEmail }">
                      <td>{{ i + 1 }}</td>
                      <td>{{ request.date | date:'mediumDate' }}</td>
                      <td>{{ request.staff }}</td>
                      <td>{{ request.patientEmail }}</td>
                      <td>
                        <ul style="list-style-type: none; padding: 0; margin: 0;">
                          <li *ngFor="let allergie of request.allergies">{{ allergie.designacao }}</li>
                        </ul>
                      </td>
                      <td>
                        <ul style="list-style-type: none; padding: 0; margin: 0;">
                          <li *ngFor="let conditon of request.medicalConditions">{{ conditon.designacao }}</li>
                        </ul>
                      </td>

                      <td>
                        <ul style="list-style-type: none; padding: 0; margin: 0;">
                          <li *ngFor="let description of request.descricao">{{ description }}</li>
                        </ul>
                      </td>
                   
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="col-md-9"></div>
          <div class="col-md-3">
            <button class="fs-5 btn btn-outline-info" id="filterMedicalRecord" (click)="getMedicalRecord()">Filter <i class="bi bi-info-square-fill"></i></button>
            
            <button class="fs-5 btn btn-outline-warning" id="editMedicalRecord" (click)="editMedicalRecord()">Edit <i
                class="bi bi-pencil-square"></i></button>

            <button class="fs-5 btn btn-outline-danger" id="deleteMedicalRecord" (click)="deleteMedicalRecord()"> Deactivate <i class="bi bi-archive-fill"></i></button>
          </div>
        </form>
      </div>

    </div>
  </div>


  <div [ngStyle]="{'display': isModalOpen('FilterMedicalRecord') ? 'block' : 'none'}" id="FilterMedicalRecord" class="modal">
    <div class="modal-content">
      <span (click)="closeModal('FilterMedicalRecord')" class="close">&times;</span>
      <form class="row g-3 needs-validation" novalidate="">
        <div *ngIf="medicalRecordProfile">

          <div class="row g-3 needs-validation">
            <div class="col-md-12"></div>
  
 
            <div class="col-md-4">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-person-badge-fill"></i></span>
                <input type="text" class="form-control" id="allergieNameFilter" [(ngModel)]="allergieNameFilter"  [ngModelOptions]="{standalone: true}"  name="allergieNameFilter" required step="1" placeholder="Name" />
              </div>
            </div>
  
            <div class="col-md-4">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-body-text"></i></span>
                <input type="text" class="form-control" id="allergieDescriptionFilter" [(ngModel)]="allergieDescriptionFilter"  [ngModelOptions]="{standalone: true}"  name="allergieDescriptionFilter" required step="2" placeholder="Description" />
              </div>
            </div>
  
            <div class="col-md-4">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-person-vcard-fill"></i></span>
                <textarea class="form-control" id="allergieStatusFilter" [(ngModel)]="allergieStatusFilter"  [ngModelOptions]="{standalone: true}"  name="allergieStatusFilter" required rows="1" placeholder="Status"></textarea>
              </div>
            </div>

            <div class="col-md-6" >
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <textarea class="form-control" id="allergieNoteFilter" [(ngModel)]="allergieNoteFilter"
                  [ngModelOptions]="{standalone: true}" name="allergieNoteFilter" required rows="1"
                  placeholder="Note">></textarea>
              </div>
            </div>
  
            <div class="input-group" style="padding:1cm">
              <span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i></span>
              <button type="submit" id="filterAllergieMedicalRecord" (click)="onFilterMedicalRecordRequests()" class="btn btn-primary">Apply Allergie Filter</button>
            </div>
  
            <div class="col-md-12">
              <!-- Tabela de Alergias -->
              <div class="input-group has-validation">
                <span class="input-group-text" style="width:20%" id="basic-addon1"><i class="bi bi-virus"></i></span>
                <span class="input-group-text" style="width:60%" id="add">Allergies</span>
              </div>
              <table class="table table-striped table-hover table-over-update">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let tag of filteredTagsAllergies; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ tag.designacao }}</td>
                    <td>{{ tag.descricao }}</td>
                    <td>{{ tag.status }}</td>
                    <td [style.white-space]="'pre-wrap'">{{ tag.note }}</td>    
                  </tr>
                </tbody>
              </table>
            </div>

            <hr>
  
  
            <div class="col-mb-12"></div>
  
            
            <div class="col-md-4">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-person-badge-fill"></i></span>
                <input type="text" class="form-control" id="medicalConditionCodeFilter" [(ngModel)]="medicalConditionCodeFilter"  [ngModelOptions]="{standalone: true}" name="medicalConditionCodeFilter" required step="1" placeholder="Code" />
              </div>
            </div>

           <div class="col-md-4">
            <div class="input-group has-validation">
              <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-person-badge-fill"></i></span>
              <input type="text" class="form-control" id="medicalConditionNameFilter"  [(ngModel)]="medicalConditionNameFilter"  [ngModelOptions]="{standalone: true}"   name="medicalConditionNameFilter" required step="1" placeholder="Name"/>
            </div>
         </div>

  
            <div class="col-md-4">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-body-text"></i></span>
                <input type="text" class="form-control" id="medicalConditionDescriptionFilter" [(ngModel)]="medicalConditionDescriptionFilter"  [ngModelOptions]="{standalone: true}"  name="medicalConditionDescriptionFilter" required step="2" placeholder="Description" />
              </div>
            </div>
  
            <div class="col-md-4">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-person-vcard-fill"></i></span>               
                <input class="form-control" id="medicalConditionStatusFilter" [(ngModel)]="medicalConditionStatusFilter"  [ngModelOptions]="{standalone: true}"  name="medicalConditionStatusFilter" required rows="1" placeholder="Status" />
              </div>
            </div>

            <div class="col-md-6">
              <div class="input-group has-validation">
                <span  class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <textarea type="text" class="form-control" id="medicalConditionSymptomsFilter" [(ngModel)]="medicalConditionSymptomsFilter"  [ngModelOptions]="{standalone: true}" 
                 name="medicalConditionSymptomsFilter" required rows="1"
                  placeholder="Symptoms [Separated by a comma (,)]"></textarea>
              </div>
            </div>


            
            <div class="col-md-6" >
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <textarea class="form-control" id="medicalConditionNoteFilter" [(ngModel)]="medicalConditionNoteFilter"
                  [ngModelOptions]="{standalone: true}" name="medicalConditionNoteFilter" required rows="1"
                  placeholder="Note">></textarea>
              </div>
            </div>

            <div class="input-group" style="padding:1cm">
              <span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i></span>
            <button type="submit" id="filterConditionMedicalRecord" (click)="onFilterMedicalRecordRequestsConditions()" class="btn btn-primary">Apply Medical Condition Filter</button>
           </div>
  
  
            <!-- Medical Conditions Section -->
            <div class="col-md-12">
              <div class="input-group has-validation">
                <span class="input-group-text" style="width:20%" id="basic-addon1"><i class="bi bi-virus"></i></span>
                <span class="input-group-text" style="width:60%" id="add">Medical Conditions</span>
              </div>
              <table class="table table-striped table-hover table-over-update">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Symptoms</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let condition of filteredTagsConditions; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ condition.codigo }}</td>
                    <td>{{ condition.designacao }}</td>
                    <td>{{ condition.descricao }}</td>
                    <td>{{ condition.status }}</td>
                    <td>{{ condition.sintomas }}</td>
                    <td [style.white-space]="'pre-wrap'">{{ condition.note }}</td>    
                   
                  </tr>
                </tbody>
              </table>
            </div>

               
  
  
          </div>         
        </div>
      </form>
       
    </div>
  </div>

  <div [ngStyle]="{'display': isModalOpen('UpdateMedicalRecordModal') ? 'block' : 'none'}" id="UpdateMedicalRecordModal"
    class="modal">
    <div class="modal-content">
      <span (click)="closeModal('UpdateMedicalRecordModal')" class="close">&times;</span>

      <form [formGroup]="medicalRecordUpdate" class="row g-3 needs-validation" novalidate="">
        <div *ngIf="medicalRecordProfileUpdate">
          <div class="row g-3 needs-validation">
            <div class="col-md-12"></div>

            <!-- Description Field -->
             <div class="col-md-12">
              <div class="input-group has-validation">
                <span class="input-group-text" style="width:20%" id="basic-addon1"><i class="bi bi-virus"></i></span>
                <span class="input-group-text" style="width:60%" id="add">Desciption</span>
              </div>
              <table class="table table-striped table-hover table-over-update">
                <thead>
                  <tr>
                    <th>#</th>
                     <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let desciption of descricaoList; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ desciption }}</td>
                    <td> <button type="button" class="btn btn-danger"
                        (click)="removeDescription(i); $event.preventDefault()"> <i class="bi bi-trash"></i> </button></td>
                  </tr>
                </tbody>
              </table>
            </div>




            <div class="col-md-3">
              <div class="input-group has-validation">
                <span class="input-group-text" id="basic-addon1"><i class="bi bi-person-vcard-fill"></i> </span>
                <input type="text" class="form-control" id="updateMedicalRecordDescription"[(ngModel)]="filterTextDescription"
                  [ngModelOptions]="{standalone: true}" placeholder="Description" name="descriptionUpdate">
              </div>
            </div>

            <div class="col-12">
              <button type="button" class="btn btn-primary" id="buttonUpdateMedicalRecordDescription" (click)="addDescription()"  [disabled]="!filterTextDescription || filterTextDescription.trim() === ''">Add Description</button>
            </div>


            <hr>


            <!-- Allergies Section -->
            <div class="col-md-12">
              <div class="input-group has-validation">
                <span class="input-group-text" style="width:20%" id="basic-addon1"><i class="bi bi-virus"></i></span>
                <span class="input-group-text" style="width:60%" id="add">Allergies</span>
              </div>
              <table class="table table-striped table-hover table-over-update">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Note</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let tag of tagsAllergies; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ tag.designacao }}</td>
                    <td>{{ tag.descricao }}</td>
                    <td>{{ tag.status }}</td>
                    <td [style.white-space]="'pre-wrap'">{{ tag.note }}</td>                    
                    <td *ngIf="isDoctor"> <button type="button" class="btn btn-danger" 
                      (click)="removeAllergie(); $event.preventDefault()"> <i class="bi bi-trash"></i>
                    </button></td>
                    <td  *ngIf="!isDoctor">  <button type="button" class="btn btn-warning"
                      (click)="editAllergieNote(tag.designacao); $event.preventDefault()"> <i class="bi bi-pencil"></i>                       
                    </button></td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="col-mb-4" *ngIf="isDoctor">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <input id="tag-filterUpdate" class="form-control" type="text" name="filterAllergieName"
                  [(ngModel)]="filterAllergieNameText"  [ngModelOptions]="{standalone: true}"  placeholder="Choose an allergie"
                  (input)="filterAllergieNameOptions()" (focus)="showDropdown = true" (blur)="onBlur('filterAllergie')" />
                  <span class="input-group-text" id="validAllergie">{{ validAllergieText }}</span>
                <input type="text" class="form-control" id="descricaoAllergieUpdate"  style="width: 40%;" [(ngModel)]="filterAllergieDescricaoText"  [ngModelOptions]="{standalone: true}" 
                  name="descricaoAllergieUpdate" required readonly />
              </div>
              <ul *ngIf="showDropdown" class="dropdown-listUpdate">
                <li *ngFor="let option of filteredAllergieNameOptions"
                  (mousedown)="selectOptionTagAllergies(option.designacao)">
                   {{ option.designacao }}  {{option.descricao}}
                </li>
              </ul>
            </div>

           

            <div class="col-md-2" *ngIf="isDoctor" >
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <input id="status-filter" class="form-control" type="text"  name="filterAllergieStatusUpdate" [(ngModel)]="filterAllergieStatusText"
                  [ngModelOptions]="{standalone: true}" (input)="filterAllergieStatusOptions()"
                  (focus)="showDropdown3 = true" (blur)="onBlur('filterAllergieStatus')" placeholder="Filter status" />
                </div>
                <ul *ngIf="showDropdown3" class="dropdown-listUpdate">
                  <li *ngFor="let option of filteredAllergieStatusOptions"
                    (mousedown)="selectOptionTagStatusAllergies(option)">
                    {{ option }}
                  </li>
                </ul>              
            </div>

            <div class="col-md-6" *ngIf="isDoctor">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <textarea class="form-control" id="allergieNotesUpdate" [(ngModel)]="noteAllergie"
                  [ngModelOptions]="{standalone: true}" name="allergieNotesUpdate" required rows="1"
                  placeholder="Note"[disabled]="filterAllergieStatusText !== 'Not Meaningful Anymore' && filterAllergieStatusText !== 'Misdiagnosed'">></textarea>
              </div>
            </div>



           
            <div class="col-12" style="margin-bottom: 30px;" *ngIf="isDoctor">
              <button type="button" class="btn btn-primary"  id="updateAddAllergie" (click)="addAllergie('yes')" [disabled]="!isAllergieValid()">Add Allergie</button>
            </div>

             <div class="col-mb-4"></div>


            <!-- Medical Conditions Section -->
            <div class="col-md-12">
              <div class="input-group has-validation">
                <span class="input-group-text" style="width:20%" id="basic-addon1"><i class="bi bi-virus"></i></span>
                <span class="input-group-text" style="width:60%" id="add">Medical Conditions</span>
              </div>
              <table class="table table-striped table-hover table-over-update">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Symptoms</th>
                    <th>Node</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let condition of tagsConditions; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ condition.codigo }}</td>
                    <td>{{ condition.designacao }}</td>
                    <td>{{ condition.descricao }}</td>
                    <td>{{ condition.status }}</td>
                    <td>{{ condition.sintomas }}</td>
                    <td [style.white-space]="'pre-wrap'">{{ condition.note }}</td>
                    <td *ngIf="isDoctor"> <button type="button" class="btn btn-danger" 
                        (click)="removeMedicalCondition(); $event.preventDefault()"> <i class="bi bi-trash"></i>
                      </button></td>
                      <td  *ngIf="!isDoctor">  <button type="button" class="btn btn-warning"
                        (click)="editMedicalConditionNote(condition.codigo); $event.preventDefault()"> <i class="bi bi-pencil"></i>                       
                      </button></td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="col-mb-4" *ngIf="isDoctor">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <input id="condition-filterUpdate" class="form-control" type="text" name="filterMedicalCondiitonDesignacao"
                  [(ngModel)]="filterTextCondition"  [ngModelOptions]="{standalone: true}"  placeholder="Choose an medical condition"
                  (input)="filterOptionsMedicalConditions()" (focus)="showDropdown2 = true" (blur)="onBlur('filterCondition')" />
                  <span class="input-group-text" id="validCondition">{{ validConditionText }}</span>
                <input type="text" class="form-control" id="descricaoConditionUpdate"  style="width: 40%;" [(ngModel)]="filterConditionDescricaoText"  [ngModelOptions]="{standalone: true}" 
                  name="descricaoConditionUpdate" required readonly />
              </div>
              <ul *ngIf="showDropdown2" class="dropdown-list">
                <li *ngFor="let option of filteredOptionsConditions"
                  (mousedown)="selectOptionMedicalCondition(option.designacao)">
                  [{{option.codigo}}] {{ option.designacao }}
                </li>
              </ul>
            </div>

            <div class="col-md-12 mt-3"></div>

            <div class="col-md-2" *ngIf="isDoctor">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <input id="status-filter" class="form-control" type="text" name="filterConditionStatusUpdate"
                  [(ngModel)]="filterConditionStatusText" [ngModelOptions]="{standalone: true}" placeholder="Filter status"
                  (input)="filterConditionStatusOptions()" (focus)="showDropdown4 = true" (blur)="onBlur('filterStatus')" />         
              
              </div>
              <ul *ngIf="showDropdown4" class="dropdown-listUpdate">
                <li *ngFor="let option of filteredAllergieStatusOptions"
                  (mousedown)="selectOptionTagStatusCondition(option)">
                  {{ option }}
                </li>
              </ul>
            </div>


            <div class="col-md-6" *ngIf="isDoctor">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <textarea class="form-control" id="conditionNotesUpdate" [(ngModel)]="noteCondition"
                  [ngModelOptions]="{standalone: true}" name="conditionNotesUpdate" required rows="1"
                  placeholder="Note" [disabled]="filterConditionStatusText !== 'Not Meaningful Anymore' && filterConditionStatusText !== 'Misdiagnosed'"></textarea>
              </div>
            </div>

          
            <div class="col-md-8" *ngIf="isDoctor">
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
                <textarea class="form-control" id="medicalConditionSymptomsUpdate" [(ngModel)]="sintomasCodition"
                  [ngModelOptions]="{standalone: true}" name="medicalConditionSymptoms" required rows="1"
                  placeholder="Symptoms [Separated by a comma (,)]"></textarea>
              </div>

            </div>


            <div class="col-12" style="margin-bottom: 30px;" *ngIf="isDoctor">
              <button type="button" class="btn btn-primary" id="updateAddCondition" (click)="addMedicalCondition('yes')" [disabled]="!isConditionValid()">Add Condition</button>
            </div>


          </div>

          <div class="col-12" style="margin-bottom: 20px;">
            <button type="button" class="btn btn-secondary" id="updateMedicalRecordPolicy" (click)="openPolicyModal()">Read and Agree to Policy</button>
          </div>



          <button class="btn btn-primary" [disabled]="!isPolicyAccepted" id="updateMedicalRecord" (click)="onUpdateMedicalRecord()">Edit Medical Record</button>
        </div>
      </form>
    </div>
  </div>

  <div [ngStyle]="{'display': isModalOpen('UpdateOtherDoctorMedicalRecordModalAllergie') ? 'block' : 'none'}" id="UpdateOtherDoctorMedicalRecordModalAllergie"
  class="modal">
  <div class="modal-content">
    <span (click)="closeModal('UpdateOtherDoctorMedicalRecordModalAllergie')" class="close">&times;</span>

    <form class="row g-3 needs-validation" novalidate="">
      <div *ngIf="medicalRecordProfileUpdate">
        <div class="row g-3 needs-validation">
          <div class="col-md-12"></div>

       
          <div class="col-md-6">
            <div class="input-group has-validation">
              <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
              <textarea class="form-control" id="allergieNotesOtherDoctorUpdate" [(ngModel)]="noteAllergie"
                [ngModelOptions]="{standalone: true}" name="allergieNotesOtherDoctorUpdate" required rows="1"
                placeholder="Note">
              </textarea>
            </div>
          </div>


        </div>

        
        <div class="col-12" style="margin-top: 30px;">
          <button type="button" class="btn btn-primary" id="updateAddOtherDoctorAllergie" (click)="updateNoteAllergies()" >Update Allergy Note</button>
        </div>



       
      </div>
    </form>
  </div>
</div>




  <div [ngStyle]="{'display': isModalOpen('UpdateOtherDoctorMedicalRecordModal') ? 'block' : 'none'}" id="UpdateOtherDoctorMedicalRecordModal"
  class="modal">
  <div class="modal-content">
    <span (click)="closeModal('UpdateOtherDoctorMedicalRecordModal')" class="close">&times;</span>

    <form class="row g-3 needs-validation" novalidate="">
      <div *ngIf="medicalRecordProfileUpdate">
        <div class="row g-3 needs-validation">
          <div class="col-md-12"></div>

       
          <div class="col-md-6">
            <div class="input-group has-validation">
              <span class="input-group-text" id="inputGroupPrepend"><i class="bi bi-clipboard-pulse"></i></span>
              <textarea class="form-control" id="conditionNotesOtherDoctorUpdate" [(ngModel)]="noteCondition"
                [ngModelOptions]="{standalone: true}" name="conditionNotesOtherDoctorUpdate" required rows="1"
                placeholder="Note">
              </textarea>
            </div>
          </div>


        </div>

        
        <div class="col-12" style="margin-top: 30px;">
          <button type="button" class="btn btn-primary" id="updateAddOtherDoctorCondition" (click)="updateNoteMedicalCondition()" >Update Condition Note </button>
        </div>



       
      </div>
    </form>
  </div>
</div>





  <div class="container-xxl">
    <button class="btn-right" (click)="logout()">Logout</button>
  </div>





  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
